CREATE OR REPLACE FUNCTION public.getexperimentsession(
	arg_belonged_project_id_key TEXT)
    RETURNS TABLE(
        tb_experiment_id_key TEXT,
        tb_experiment_names CHARACTER VARYING,
        tb_experiment_logs TEXT,
        tb_experiment_output_log TEXT,
        tb_experiment_system_metrics TEXT,
        tb_experiment_hyper_parameter TEXT,
        tb_experiment_requirements TEXT,
        tb_experiment_code_blob_id BIGINT,
        tb_experiment_image_blob TEXT,
        tb_experiment_model_blob TEXT,
        tb_experiment_creator CHARACTER VARYING,
        tb_experiment_created_dated TIMESTAMP WITHOUT TIME ZONE,
        tb_experiment_status SMALLINT,
        tb_experiment_chart_config TEXT)
    LANGUAGE 'plpgsql'

    COST 100
    VOLATILE
    ROWS 1000

AS $BODY$
DECLARE
    v_project_id INTEGER;
BEGIN

    SELECT id FROM public.project
        WHERE public.project.access_key = arg_belonged_project_id_key
        INTO v_project_id;

    IF v_project_id IS NOT NULL THEN
        RETURN QUERY
            SELECT DISTINCT public.experiment.access_key,
                public.experiment.name,
				array_to_json(public.experiment.log)::text,
				array_to_string(public.experiment.output_log, E'\n', '*') ,
				array_to_string(public.experiment.system_metrics, E'\n', '*'),
				public.experiment.hyper_parameter,
				public.experiment.requirements,
				public.experiment.code_blob_id,
				array_to_string(public.experiment.image_blob_id, E'\n', '*'),
				array_to_string(public.experiment.model_blob_id, E'\n', '*'),
				public.account.account_id,
				public.experiment.created_date,
                public.experiment.experiment_state,
                public.experiment.chart_config
					FROM public.experiment
                LEFT JOIN public.project ON public.experiment.belonged_project_id = public.project.id
                LEFT JOIN public.account ON public.experiment.creator = public.account.id
                WHERE public.project.id = v_project_id
                ORDER BY public.experiment.created_date DESC;
    ELSE
        RETURN NEXT;
    END IF;
END;$BODY$;

SELECT * FROM public.getexperimentsession('4rneq38bfy2kvvt0');
SELECT * FROM public.getexperimentsession('aaaaaaaaaa34');

DROP FUNCTION getexperimentsession(text);